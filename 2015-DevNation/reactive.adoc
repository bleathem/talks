= Transform your web applications with reactive functional programming
Brian Leathem <https://github.com/brianleathem[@brianleathem]>
:backend: dzslides
:dzslides-transition: fade
:dzslides-aspect: 16-9
:dzslides-style: ../../../themes/devnation
:dzslides-highlight: github
:source-highlighter: highlightjs
:imagesdir: images
:linkattrs:

== Reactive with Rx.js
[.side-by-side]
--
* Async JavaScript review
* Observables are what?
* Use cases and examples

image::storm_troopers.jpg[Storm Troopers, alt="http://www.flickr.com/photos/jdhancock/5845280258/"]
--

[NOTE.details]
====
 * A better title would be simply "Ractive with Rx.js"
 * This is *not* a talk on React - the web framework put out by facebook
 * In this session we will run trhough a quick review of Asynchronous programming with javascript
 * We will introduce the concept of the Observable, and look at how it enables us to handle aysnch in a functional reactive way
 * We'll look at a bunch of examples to demonstrate the power of Observalbes
====

== Who am I?
[.side-by-side]
--
image::silhouette.png[Silhouette, alt="http://leslycorazon.wikispaces.com/file/detail/head-silhouette-with-question-mark.png/319199232"]

* Brian Leathem
* Software Engineer @ Red Hat
* Works on developer tools and frameworks
--

[NOTE.details]
====
*
====

== Who are you?
image::crowd.svg[crowd, alt="https://openclipart.org/detail/22519/crowd"]

[NOTE.details]
====
* And how about you guys, lets' get an idea of the audience we have here today.
* Can I see a show of hands
** from those in the audience who consider themselves *proficient with javascript*?
** And how about those of you who have *used node.js*?
====

[.topic]
== Async JavaScript

[NOTE.details]
====
* Great, with the introductions out of the way let's dive into the good stuff
====

== Callbacks
[.side-by-side]
--

++++
<div>
++++
Asynchronous javascript:

[source,javascript]
----
function asyncTask(args, callback) {
  // do stuff
  callback()
}
----

++++
</div>
++++

++++
<div>
++++
image::protester.svg[jquery, alt="https://openclipart.org/detail/202235/protester", height="100%"]
++++
</div>
++++

--

[NOTE.details]
====
* XHR, timeouts & intervals, event listeners, geolocations
* node.js
====

== Invoking `asyncTask`
[.side-by-side]
--

[source,javascript]
----
asyncTask(args, function() {
  // task is done here!
})
----

.Anonymous function:
* simple
* concise
* well-accepted pattern

--

[NOTE.details]
====
====

== Nesting async calls - serial
[.side-by-side]
--

[source,javascript]
----
asyncTask1(args, function() {
  asyncTask2(args, function() {
    asyncTask1(args, function() {
      // task is done here!
    })
  })
})
----

++++
<div>
++++
image::callback.png[callback, width="100%"]
++++
</div>
++++

--

[NOTE.details]
====
====

== Simultaneous callbacks - parallel
[source,javascript]
----
var result1=false; result2=false; // state!!

asyncTask1(function(){a1=true; doAction()}
asyncTask2(function(){a2=true; doAction()}

function doAction() {
  if (a1 && a2) {
    â€¦
  }
}
----

[NOTE.details]
====
* What about error handling?
* what if one of these aync tasks results in an error?
====

== Promises to the rescue!

.Serial:
[source,javascript]
----
asyncTask1.then(asyncTask2).then(function() {
  // success
}, function(err) {
  // error
})
----

++++
<br />
++++

.Parallel:
[source,javascript]
----
Promise.all(asyncTask1, asyncTask2).then(...)
----


[NOTE.details]
====
* chain asynchornous tasks, rather then nest them
* library functions for executing them in parallel
* Error handling is well-defined and consistent
====

[.center]
== What about events?

image::reactive-chart.jpg[chart, alt="http://www.slideshare.net/stefanmayer13/functional-reactive-programming-with-rxjs", width="800px"]

[NOTE.details]
====
* jQuery plugins execute *once*, either on page load, or in response to some event.
* On their own this makes them useful for use cases where we want to execute the plugin and have some desired side-effect
* There are however a number of uses cases that the jQuery plugin mechanism doesn't cover out-of-the box
====

== Observable what?!

[.center]
Think of an observable as a _collection-in-time_

[.center]
--
.Same _functional_ tools apply
* `forEach`
* `filter`
* `map`
* ...
--

== Imperative vs. Functional
[.center]
--
_Iterating over an array_
--

[.side-by-side]
--
.Imperative:
[source,javascript]
----
for (var i=0; i < a.length; i++) {
  item = a[i];
  // item.doAction()
}
----

.Functional:
[source,javascript]
----
a.forEach(function(item) {
  // item.doAction()

})

----
--

[NOTE.details]
====
* Writing functional code is like saying your a vegetarian.
====

[.codepen]
== A Collection

++++
<p data-height="520" data-theme-id="0" data-slug-hash="QbgKmp" data-default-tab="result" data-user="bleathem" class='codepen'>See the Pen <a href='http://codepen.io/bleathem/pen/QbgKmp/'>Collection | Iden</a> by Brian Leathem (<a href='http://codepen.io/bleathem'>@bleathem</a>) on <a href='http://codepen.io'>CodePen</a>.</p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>
++++

[.codepen]
== An Observable

++++
<p data-height="520" data-theme-id="0" data-slug-hash="mJwrae" data-default-tab="result" data-user="bleathem" class='codepen'>See the Pen <a href='http://codepen.io/bleathem/pen/mJwrae/'>Observable</a> by Brian Leathem (<a href='http://codepen.io/bleathem'>@bleathem</a>) on <a href='http://codepen.io'>CodePen</a>.</p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>
++++

== Functional examples

Collections

http://codepen.io/bleathem/pen/aONazB

Observables

http://codepen.io/bleathem/pen/pJyOMN

== Rx.js

_Reactive Extensions for JavaScript_

[quote]
...is a set of libraries to compose asynchronous and event-based programs using observable collections and Array#extras style composition in JavaScript

[NOTE.details]
====
*Next let's look at how we can use Rx.JS to create and consume Observables
====

[.tweet]
== A Burgeoning Standard

++++
<blockquote class="twitter-tweet tw-align-center" lang="en"><p lang="en" dir="ltr">Observable in JavaScript proposal presented to TC-39 (JS standards committee) today. Advanced to Stage 1 (Proposal). <a href="https://t.co/sBuazdM7vR">https://t.co/sBuazdM7vR</a></p>&mdash; Jafar Husain (@jhusain) <a href="https://twitter.com/jhusain/status/604111900012511232">May 29, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
++++

== Creating Observables

.Brute Force:
[source,javascript]
----
var source = Rx.Observable.create(function (observer) {
  observer.onNext(42);
  observer.onCompleted();

  // Optional: only return this if cleanup is required
  return function () {
    console.log('disposed');
  };
});
----

== Example: mousemove

.Using the brute force approach:
[source,javascript]
----
Rx.Observable.create(function(observer) {
  var element = document.getElementById("box1");
  element.addEventListener("mousemove", function(event) {
    observer.onNext(event);
  }, false);
});
----

== Example: mousemove

.Using the `fromEvent` helper
[source,javascript]
----
var element = document.getElementById("box1");
Rx.Observable.fromEvent(element, 'mousemove');
----

== Consuming Observables
[source,javascript]
----
Rx.Observable.fromEvent(element, 'mousemove')
  .subscribe(
    function(event) {
      console.log(event);
    },
    function(error) {
      concole.log(error);
    },
    function() {
      // stream completed
    }
----

== Learn Rx
http://reactive-extensions.github.io/learnrx/

== Use Case: jQuery .on()
[source,javascript]
----
Rx.Observable.fromEvent(element, 'mousemove')
  .filter(function(event) {
    return event.target.classList.contains('myClass');
  })
  .subscribe(...);
----

== User Case: Drag and Drop

.Define the Observables:
[source,javascript]
----
var dragTarget = document.getElementById('dragTarget');
var mouseup   = Rx.Observable.fromEvent(dragTarget, 'mouseup');
var mousemove = Rx.Observable.fromEvent(document,   'mousemove');
var mousedown = Rx.Observable.fromEvent(dragTarget, 'mousedown');
----

== User Case: Drag and Drop

.Manipulate the Observables
[source,javascript]
----
var mousedrag = mousedown.flatMap(function (md) {
  var startX = md.offsetX, startY = md.offsetY;
  return mousemove.map(function (mm) {
    mm.preventDefault();
    return {
      left: mm.clientX - startX,
      top: mm.clientY - startY
    };
  }).takeUntil(mouseup);
});
----

== User Case: Drag and Drop

.Subscribe to Observables
[source,javascript]
----
var subscription = mousedrag.subscribe(function (pos) {
  dragTarget.style.top = pos.top + 'px';
  dragTarget.style.left = pos.left + 'px';
});
----

[.codepen]
== Example: Drag and Drop
++++
<p data-height="620" data-theme-id="0" data-slug-hash="JdJbzX" data-default-tab="result" data-user="bleathem" class='codepen'>See the Pen <a href='http://codepen.io/bleathem/pen/JdJbzX/'>Event Listener</a> by Brian Leathem (<a href='http://codepen.io/bleathem'>@bleathem</a>) on <a href='http://codepen.io'>CodePen</a>.</p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>
++++
