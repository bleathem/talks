= Transform your web applications with reactive functional programming
Brian Leathem <https://github.com/brianleathem[@brianleathem]>
:backend: dzslides
:dzslides-transition: fade
:dzslides-aspect: 16-9
:dzslides-style: ../../../themes/devnation
:dzslides-highlight: github
:source-highlighter: highlightjs
:imagesdir: images
:linkattrs:

== This is not...
image::react.png[crowd, alt="https://openclipart.org/detail/22519/crowd"]

[.topic]
== Reactive programming with Rx.js
[NOTE.details]
====
 * A better title would be simply "Reactive with Rx.js"
 * This is *not* a talk on React - the web framework put out by facebook
 * In this session we will run trhough a quick review of Asynchronous programming with javascript
 * We will introduce the concept of the Observable, and look at how it enables us to handle aysnch in a functional reactive way
 * We'll look at a bunch of examples to demonstrate the power of Observalbes
====


== The plan
[.side-by-side]
--
* Async JavaScript review
* Observables are what?
* Use cases and examples

image::storm_troopers.jpg[Storm Troopers, alt="http://www.flickr.com/photos/jdhancock/5845280258/"]
--


== Who am I?
[.side-by-side]
--
image::silhouette.png[Silhouette, alt="http://leslycorazon.wikispaces.com/file/detail/head-silhouette-with-question-mark.png/319199232"]

* Brian Leathem
* Software Engineer @ Red Hat
* Works on developer tools and frameworks
--

[NOTE.details]
====
*
====

== Who are you?
image::crowd.svg[crowd, alt="https://openclipart.org/detail/22519/crowd"]

[NOTE.details]
====
* And how about you guys, lets' get an idea of the audience we have here today.
* Can I see a show of hands
** from those in the audience who consider themselves *proficient with javascript*?
** And how about those of you who have *used node.js*?
====

[.topic]
== Async JavaScript

[NOTE.details]
====
* Great, with the introductions out of the way let's dive into the good stuff
====

== Async Javascript
* XHR
* Animations
* Timeout
* Event Listeners

== Callbacks
[.side-by-side]
--

++++
<div>
++++
Asynchronous javascript:

[source,javascript]
----
function asyncTask(args, callback) {
  // do stuff
  callback()
}
----

++++
</div>
++++

++++
<div>
++++
image::protester.svg[jquery, alt="https://openclipart.org/detail/202235/protester", height="100%"]
++++
</div>
++++

--

[NOTE.details]
====
* XHR, timeouts & intervals, event listeners, geolocations
* node.js
====

== Invoking `asyncTask`
[.side-by-side]
--

[source,javascript]
----
asyncTask(args, function() {
  // task is done here!
})
----

.Anonymous function:
* simple
* concise
* well-accepted pattern

--

[NOTE.details]
====
====

== Nesting async calls - serial
[.side-by-side]
--

[source,javascript]
----
asyncTask1(args, function() {
  asyncTask2(args, function() {
    asyncTask1(args, function() {
      // task is done here!
    })
  })
})
----

++++
<div>
++++
image::callback.png[callback, width="100%"]
++++
</div>
++++

--

[NOTE.details]
====
====

== Simultaneous callbacks - parallel
[source,javascript]
----
var result1=false; result2=false; // state!!

asyncTask1(function(){a1=true; doAction()}
asyncTask2(function(){a2=true; doAction()}

function doAction() {
  if (a1 && a2) {
    â€¦
  }
}
----

[NOTE.details]
====
* What about error handling?
* what if one of these aync tasks results in an error?
====

== Promises to the rescue!

.Serial:
[source,javascript]
----
asyncTask1.then(asyncTask2).then(function() {
  // success
}, function(err) {
  // error
})
----

++++
<br />
++++

.Parallel:
[source,javascript]
----
Promise.all(asyncTask1, asyncTask2).then(...)
----


[NOTE.details]
====
* chain asynchornous tasks, rather then nest them
* library functions for executing them in parallel
* Error handling is well-defined and consistent
====

[.center]
== What about events?

image::reactive-chart.jpg[chart, alt="", width="800px"]

[NOTE.details]
====
* jQuery plugins execute *once*, either on page load, or in response to some event.
* On their own this makes them useful for use cases where we want to execute the plugin and have some desired side-effect
* There are however a number of uses cases that the jQuery plugin mechanism doesn't cover out-of-the box
====

== Observable what?!

[.center]
Think of an observable as a _collection-in-time_

[.center]
--
.Same _functional_ tools apply
* `forEach`
* `filter`
* `map`
* ...
--

== Imperative vs. Functional
[.center]
--
_Iterating over an array_
--

[.side-by-side]
--
.Imperative:
[source,javascript]
----
for (var i=0; i < a.length; i++) {
  item = a[i];
  // item.doAction()
}
----

.Functional:
[source,javascript]
----
a.forEach(function(item) {
  // item.doAction()

})

----
--

[NOTE.details]
====
* Writing functional code is like saying your a vegetarian.
====

[.codepen]
== A Collection

++++
<p data-height="520" data-theme-id="0" data-slug-hash="QbgKmp" data-default-tab="result" data-user="bleathem" class='codepen'>See the Pen <a href='http://codepen.io/bleathem/pen/QbgKmp/'>Collection | Iden</a> by Brian Leathem (<a href='http://codepen.io/bleathem'>@bleathem</a>) on <a href='http://codepen.io'>CodePen</a>.</p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>
++++

[.codepen]
== An Observable

++++
<p data-height="520" data-theme-id="0" data-slug-hash="mJwrae" data-default-tab="result" data-user="bleathem" class='codepen'>See the Pen <a href='http://codepen.io/bleathem/pen/mJwrae/'>Observable</a> by Brian Leathem (<a href='http://codepen.io/bleathem'>@bleathem</a>) on <a href='http://codepen.io'>CodePen</a>.</p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>
++++

[NOTE.details]
====
* Collection in time
* Event collection
* Iterator pattern applied to Observer
====

== Rx.js

_Reactive Extensions for JavaScript_

[quote]
...is a set of libraries to compose asynchronous and event-based programs using observable collections and Array#extras style composition in JavaScript

[NOTE.details]
====
*Next let's look at how we can use Rx.JS to create and consume Observables
====

[.tweet]
== A Burgeoning Standard

++++
<blockquote class="twitter-tweet tw-align-center" lang="en"><p lang="en" dir="ltr">Observable in JavaScript proposal presented to TC-39 (JS standards committee) today. Advanced to Stage 1 (Proposal). <a href="https://t.co/sBuazdM7vR">https://t.co/sBuazdM7vR</a></p>&mdash; Jafar Husain (@jhusain) <a href="https://twitter.com/jhusain/status/604111900012511232">May 29, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
++++

== Some basic transforms
* `map`
* `reduce`
* `mergeAll`
* `reduce`
* `zip`

[NOTE.details]
====
* Rx.js is a big library, lots of functions
* Focus on these base ingredients
* We'll see more as we get into later examples
====


== `map`

[.side-by-side]
--

[source,javascript]
----
.map(function(x) {
  return {
    id: x.id
  , color: 'green'
  , size: x.size
  , type: 'square'
  };
});
----

++++
<div>
++++
Map each shape

into a green square

of the same size
++++
</div>
++++


--

== Collection `map`

[.codepen]
--
++++
<p data-height="550" data-theme-id="0" data-slug-hash="JdJNJj" data-default-tab="result" data-user="bleathem" class='codepen'>See the Pen <a href='http://codepen.io/bleathem/pen/JdJNJj/'>Operating on a Collection</a> by Brian Leathem (<a href='http://codepen.io/bleathem'>@bleathem</a>) on <a href='http://codepen.io'>CodePen</a>.</p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>
++++
--

== Observable `map`

[.codepen]
--
++++
<p data-height="655" data-theme-id="0" data-slug-hash="zGzwWg" data-default-tab="result" data-user="bleathem" class='codepen'>See the Pen <a href='http://codepen.io/bleathem/pen/zGzwWg/'>Map an Observable</a> by Brian Leathem (<a href='http://codepen.io/bleathem'>@bleathem</a>) on <a href='http://codepen.io'>CodePen</a>.</p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>
++++
--

== `reduce`
[source,javascript]
----
var outputData = inputData
  .reduce(function(acc, x) {
    return {
      id: x.id
    , color: 'green'
    , size: acc.size + x.size
    , type: 'square'
    };
  }, {size: 0});
----

== Collection `reduce`

[.codepen]
--
++++
<p data-height="550" data-theme-id="0" data-slug-hash="doRWKp" data-default-tab="result" data-user="bleathem" class='codepen'>See the Pen <a href='http://codepen.io/bleathem/pen/doRWKp/'>Reduce a Collection</a> by Brian Leathem (<a href='http://codepen.io/bleathem'>@bleathem</a>) on <a href='http://codepen.io'>CodePen</a>.</p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>
++++
--

== Observable `reduce`
[.codepen]
--
++++
<p data-height="564" data-theme-id="0" data-slug-hash="eNRWKa" data-default-tab="result" data-user="bleathem" class='codepen'>See the Pen <a href='http://codepen.io/bleathem/pen/eNRWKa/'>Reduce an Observable</a> by Brian Leathem (<a href='http://codepen.io/bleathem'>@bleathem</a>) on <a href='http://codepen.io'>CodePen</a>.</p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>
++++
--

== `mergeAll`
[source,javascript]
----
.map(function(x) {
    var y = _.clone(x);
    y.id = y.id + 80;
    y.color = 'green';
    var z = _.clone(x);
    y.size = y.size / 1.5;
    z.size = z.size / 1.5;
    return [y, z];
  })
  .mergeAll();
----

== Nested Collections
[.codepen]
--
++++
<p data-height="550" data-theme-id="0" data-slug-hash="waepdK" data-default-tab="result" data-user="bleathem" class='codepen'>See the Pen <a href='http://codepen.io/bleathem/pen/waepdK/'>Map a nested Collection</a> by Brian Leathem (<a href='http://codepen.io/bleathem'>@bleathem</a>) on <a href='http://codepen.io'>CodePen</a>.</p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>
++++
--

== Nested Collections `mergeAll`
[.codepen]
--
++++
<p data-height="550" data-theme-id="0" data-slug-hash="eNRVGx" data-default-tab="result" data-user="bleathem" class='codepen'>See the Pen <a href='http://codepen.io/bleathem/pen/eNRVGx/'>MergeAll a Collection</a> by Brian Leathem (<a href='http://codepen.io/bleathem'>@bleathem</a>) on <a href='http://codepen.io'>CodePen</a>.</p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>
++++
--

== Observable `mergeAll`
[.codepen]
--
++++
<p data-height="655" data-theme-id="0" data-slug-hash="mJwXxW" data-default-tab="result" data-user="bleathem" class='codepen'>See the Pen <a href='http://codepen.io/bleathem/pen/mJwXxW/'>MergeAll an Observable</a> by Brian Leathem (<a href='http://codepen.io/bleathem'>@bleathem</a>) on <a href='http://codepen.io'>CodePen</a>.</p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>
++++
--

== `flatMap`
`flatMap` is a shorthand for a `map` followed by a `mergeAll`.

== `zip`
[source,javascript]
----
var outputData = Rx.Observable.zip(
  input1Data,
  input2Data,
  function(x1, x2) {
    return {
      id: x1.id
    , color: x1.color
    , size: x2.size
    , type: x2.type
    };
  });
----

== Observable `zip`
[.codepen]
--
++++
<p data-height="655" data-theme-id="0" data-slug-hash="doRmgm" data-default-tab="result" data-user="bleathem" class='codepen'>See the Pen <a href='http://codepen.io/bleathem/pen/doRmgm/'>Zip an Observable</a> by Brian Leathem (<a href='http://codepen.io/bleathem'>@bleathem</a>) on <a href='http://codepen.io'>CodePen</a>.</p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>
++++
--

== Creating Observables

.Brute Force:
[source,javascript]
----
var source = Rx.Observable.create(function (observer) {
  observer.onNext(42);
  observer.onCompleted();

  // Optional: only return this if cleanup is required
  return function () {
    console.log('disposed');
  };
});
----

== Example: mousemove

.Using the brute force approach:
[source,javascript]
----
Rx.Observable.create(function(observer) {
  var element = document.getElementById("box1");
  element.addEventListener("mousemove", function(event) {
    observer.onNext(event);
  }, false);
});
----

== Example: mousemove

.Using the `fromEvent` helper
[source,javascript]
----
var element = document.getElementById("box1");
Rx.Observable.fromEvent(element, 'mousemove');
----

== Consuming Observables
[source,javascript]
----
Rx.Observable.fromEvent(element, 'mousemove')
  .subscribe(
    function(event) {
      console.log(event);
    },
    function(error) {
      concole.log(error);
    },
    function() {
      // stream completed
    }
----

== Learn Rx
http://reactive-extensions.github.io/learnrx/

== Use Case: jQuery .on()
[source,javascript]
----
Rx.Observable.fromEvent(element, 'mousemove')
  .filter(function(event) {
    return event.target.classList.contains('myClass');
  })
  .subscribe(...);
----

== Example: jQuery .on()
[.codepen]
--
++++
<p data-height="655" data-theme-id="0" data-slug-hash="bdRBYL" data-default-tab="result" data-user="bleathem" class='codepen'>See the Pen <a href='http://codepen.io/bleathem/pen/bdRBYL/'>Event Listener</a> by Brian Leathem (<a href='http://codepen.io/bleathem'>@bleathem</a>) on <a href='http://codepen.io'>CodePen</a>.</p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>
++++
--

== Use Case: Drag and Drop

.Define the Observables:
[source,javascript]
----
var dragTarget = document.getElementById('dragTarget');
var mouseup   = Rx.Observable.fromEvent(dragTarget, 'mouseup');
var mousemove = Rx.Observable.fromEvent(document,   'mousemove');
var mousedown = Rx.Observable.fromEvent(dragTarget, 'mousedown');
----

== Use Case: Drag and Drop

.Manipulate the Observables
[source,javascript]
----
var mousedrag = mousedown.flatMap(function (md) {
  var startX = md.offsetX, startY = md.offsetY;
  return mousemove.map(function (mm) {
    mm.preventDefault();
    return {
      left: mm.clientX - startX,
      top: mm.clientY - startY
    };
  }).takeUntil(mouseup);
});
----

== Use Case: Drag and Drop

.Subscribe to Observables
[source,javascript]
----
var subscription = mousedrag.subscribe(function (pos) {
  dragTarget.style.top = pos.top + 'px';
  dragTarget.style.left = pos.left + 'px';
});
----

[.codepen]
== Example: Drag and Drop
++++
<p data-height="620" data-theme-id="0" data-slug-hash="JdJbzX" data-default-tab="result" data-user="bleathem" class='codepen'>See the Pen <a href='http://codepen.io/bleathem/pen/JdJbzX/'>Event Listener</a> by Brian Leathem (<a href='http://codepen.io/bleathem'>@bleathem</a>) on <a href='http://codepen.io'>CodePen</a>.</p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>
++++

== Hot and Cold


[.side-by-side]
--
++++
<div>
++++
* Hot Observable
** Ongoing; event stream doesn't stop

* Cold Observable
** No events until you subscribe

----
{...a...b...c......d..e.....f...}
----
----
{1...2...3......4..5.....6}
----

++++
</div>
++++
++++
<table style='width:300px'><tr><td>
++++
image::hot.svg[chart, alt="https://openclipart.org/detail/170672/weather-icon-hot", height="400px"]
++++
</td>
<td>
++++

image::cold.svg[chart, alt="https://openclipart.org/detail/170665/weather-icon-cold", height="400px"]

++++
</td></tr>
</table>
++++

--

== Ending observables

----
{...1.....2....3..4...5....}.take(3)
----

++++
<br/>
++++

yields:

++++
<br/>
++++

----
{1.....2....3}
----

[NOTE.details]
====
* takeUntil
====

== Use Case: Autocomplete
[source,javascript]
----
Rx.Observable.fromEvent($input, 'keyup')
  .map(function (e) {
    return e.target.value; // Project the text from the input
  })
  .filter(function (text) {
    return text.length > 2; // Only if the text is longer than 2 characters
  })
  .debounce(750 /* Pause for 750ms */ )
  .distinctUntilChanged() // Only if the value has changed
  .flatMapLatest(searchWikipedia)
  .subscribe(function (data) {
    // ...
  });
----

[.codepen]
== Example: Autocomplete
++++
<p data-height="620" data-theme-id="0" data-slug-hash="vOZjNv" data-default-tab="result" data-user="bleathem" class='codepen'>See the Pen <a href='http://codepen.io/bleathem/pen/vOZjNv/'>Event Listener</a> by Brian Leathem (<a href='http://codepen.io/bleathem'>@bleathem</a>) on <a href='http://codepen.io'>CodePen</a>.</p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>
++++

== Middleware Keynote demo
* UI built with Rx.js (and d3.js)

[.topic]
== Demo

== Image references
* https://openclipart.org/detail/22519/crowd
* http://www.flickr.com/photos/jdhancock/5845280258/
* http://leslycorazon.wikispaces.com/file/detail/head-silhouette-with-question-mark.png/319199232
* https://openclipart.org/detail/22519/crowd
* https://openclipart.org/detail/202235/protester
* https://openclipart.org/detail/170672/weather-icon-hot
* https://openclipart.org/detail/170665/weather-icon-cold

== Conclusion
* Rx.Js allows us to complex asynchronous applications as a composition of very simple functions
* Same programming model can be used on the back-end, and front-end

== Resources
* http://reactive-extensions.github.io/learnrx/ "Learn Rx"
* https://www.youtube.com/watch?v=FAZJsxcykPs
---
"Async Javascript at Netflix"
---
* https://github.com/Reactive-Extensions/RxJS

* http://twitter.com/brianleathem
